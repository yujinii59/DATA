select * from m4s_o201001_new WHERE SP1_QTY > 0 ORDER BY MODIFY_DATE DESC

select * from M4S_I002174


SELECT * FROM M4S_O110620 WHERE CUST_GRP_CD = 'LA09'

SELECT * FROM M4S_I002011 WHERE COMM_CD LIKE '%MEASURE%'

SELECT STRG_CD, STRG_NM FROM M4S_I002091
WHERE 1=1
  AND STRG_CD IN (
							  SELECT CUST_GRP_CD
							    FROM M4S_O110620
							   WHERE 1=1
								 AND PROJECT_CD =  :VS_PROJECT_CD
								 AND DATA_VRSN_CD = :VS_CB_DATA_VRSN_CD
								 AND DIVISION_CD = :VS_CB_DIVISION
							   GROUP BY CUST_GRP_CD
							 )


SELECT * FROM M4S_I204022 WHERE SALES_MGMT_TYPE_CD = 'SP2' AND SALES_MGMT_CD = '1011106'

SELECT * FROM M4S_O110300 WHERE ITEM_CD = '5139979'

select * from m4s_o110310

SELECT * FROM M4S_O201001_NEW WHERE SALES_MGMT_CD = '11111011120' AND DP_VRSN_ID = 'SP_2021W52.01'

select * from M4S_I204050 where SALES_MGMT_VRSN_ID = '202111_V0'


	 SELECT DISTINCT SALES_MGMT_CD
	 FROM M4S_I204050
	 WHERE SALES_MGMT_VRSN_ID = '202111_V0'
	  AND SALES_MGMT_CD LIKE '%1024'


SELECT * FROM M4S_I002040 WHERE ITEM_ATTR01_CD IS NOT NULL


SELECT DISTINCT BAK.ITEM_ATTR01_CD
    , IF_DATA.ITEM_ATTR01_CD
--     , BAK.ITEM_ATTR02_CD
--     , IF_DATA.ITEM_ATTR02_CD
--     , BAK.ITEM_ATTR03_CD
--     , IF_DATA.ITEM_ATTR03_CD
--     , BAK.ITEM_ATTR04_CD
--     , IF_DATA.ITEM_ATTR04_CD
--     , BAK.ITEM_ATTR05_CD
--     , IF_DATA.ITEM_ATTR05_CD
FROM M4S_I002040_BAK BAK
    , M4S_I002040_IF_DATA IF_DATA
WHERE BAK.PROJECT_CD = IF_DATA.PROJECT_CD
AND BAK.ITEM_CD = IF_DATA.ITEM_CD
AND BAK.ITEM_ATTR01_CD IS NOT NULL


SELECT * FROM M4S_I002011 WHERE COMM_CD = 'ITEM_MAPPING'


INSERT INTO M4S_I002011
(
 PROJECT_CD
 , IF_VRSN_ID
 ,COMM_CD
 ,COMM_DTL_CD
 ,COMM_DTL_CD_NM
 ,CREATE_USER_CD
 ,CREATE_DATE
)
SELECT 'ENT001'
    , '-'
    , 'ITEM_MAPPING'
    , '0006000030'
    , 'P414'
    , 'SYSTEM'
    , GETDATE()


P414004,00060000300120
P414006,00060000300110
P403011,00060000200230
P304023,00020000100040



FROM (
     SELECT DISTINCT BAK.ITEM_ATTR02_CD NM
        , IF_DATA.ITEM_ATTR02_CD CD
    FROM M4S_I002040_BAK BAK
        , M4S_I002040_IF_DATA IF_DATA
    WHERE BAK.PROJECT_CD = IF_DATA.PROJECT_CD
    AND BAK.ITEM_CD = IF_DATA.ITEM_CD
    AND BAK.ITEM_ATTR01_CD IS NOT NULL
    AND IF_DATA.ITEM_ATTR02_CD IN  ('0006000030', '0001000070', '0001000150') ) T1


('00010') 5
('0006000030', '0001000070', '0001000150') 10
('00060000300120','00020000100040','00060000200230','00060000300110','00010001500010') 14
('000100015000100040','000200001000400010','000600003001100010','000100015000100010','000600002002300010',
                                      '000600003001200010','000100015000100020','000100015000100030','000100015000100050')
18

SELECT T1.CD
FROM (
SELECT DISTINCT BAK.ITEM_ATTR05_CD NM
        , IF_DATA.ITEM_ATTR05_CD CD
    FROM M4S_I002040_BAK BAK
        , M4S_I002040_IF_DATA IF_DATA
    WHERE BAK.PROJECT_CD = IF_DATA.PROJECT_CD
    AND BAK.ITEM_CD = IF_DATA.ITEM_CD
    AND BAK.ITEM_ATTR01_CD IS NOT NULL
    ) T1
GROUP BY T1.CD
HAVING COUNT(*) > 1




SELECT * FROM M4S_I002011 WHERE COMM_CD = 'ITEM_MAPPING' AND COMM_DTL_CD = '00060'

SELECT * FROM M4S_I002011 WHERE COMM_CD = 'ITEM_MAPPING' AND COMM_DTL_CD IN ('P104','P105','P110','P601','P406','P414')


SELECT COMM_DTL_CD,COMM_DTL_CD_NM FROM M4S_I002011 WHERE COMM_CD = 'ITEM_GUBUN02' AND COMM_DTL_CD IN ('P104','P105','P110','P601','P406','P414')

SELECT DISTINCT BAK.ITEM_ATTR03_CD SYSTEM_BRAND_CD
        , IF_DATA.ITEM_ATTR03_CD SAP_BRAND_CD
        , COMM1.COMM_DTL_CD_NM
    FROM M4S_I002040_BAK BAK
        , M4S_I002040_IF_DATA IF_DATA
, M4S_I002011 COMM1
    WHERE BAK.PROJECT_CD = IF_DATA.PROJECT_CD
    AND BAK.ITEM_CD = IF_DATA.ITEM_CD
    AND IF_DATA.PROJECT_CD = COMM1.PROJECT_CD
    AND COMM1.COMM_CD = 'ITEM_GUBUN03'
    AND COMM1.COMM_DTL_CD = BAK.ITEM_ATTR03_CD
    AND BAK.ITEM_ATTR01_CD IS NOT NULL
    AND IF_DATA.ITEM_ATTR03_CD IN  ('00060000300120','00020000100040','00060000200230','00060000300110','00010001500010')
GROUP BY BAK.ITEM_ATTR03_CD
        , IF_DATA.ITEM_ATTR03_CD
        --, COMM.COMM_DTL_CD_NM
        , COMM1.COMM_DTL_CD_NM


SELECT * FROM M4S_I002170


SELECT * FROM M4S_I002040_IF_DATA

SELECT * INTO M4S_I002011_BAK FROM M4S_I002011

SELECT * --INTO M4S_I002011_BAK2
 FROM M4S_I002011_BAK

DROP TABLE M4S_I002011

SELECT * INTO M4S_I002011 FROM M4S_I002011_BAK

SELECT * FROM VIEW_I002040

select * into m4s_i002011 from m4s_i002011_tmp



select * from M4S_I002174



SELECT * FROM M4S_I002011_BAK WHERE COMM_CD = 'ITEM_GUBUN04'

INSERT INTO M4S_I002011_BAK
    (PROJECT_CD
    , IF_VRSN_ID
    , COMM_CD
    , COMM_DTL_CD
    , COMM_DTL_CD_NM
    , ATTR01_VAL
    , ATTR02_VAL
    , USE_YN
    , CREATE_USER_CD
    , CREATE_DATE)

-- UPDATE M4S_I002011
--     SET COMM_DTL_CD_NM = T1.ITEM_ATTR04_NM
-- SELECT  T2.COMM_DTL_CD_NM
--       , T2.COMM_DTL_CD
--       , T1.ITEM_ATTR04_CD
-- ,T1.ITEM_ATTR04_NM
-- FROM M4S_I002011 T2
--      RIGHT JOIN
-- --      FROM
--      (
         select 'ENT001'
              ,'-'
              ,'ITEM_GUBUN04'
              , COMM.COMM_DTL_CD + FORMAT(ROW_NUMBER() over (PARTITION BY COMM_DTL_CD ORDER BY ITEM_ATTR04_CD),'000')
              , ITEM_ATTR24_CD
              , COMM_DTL_CD
             , ITEM_ATTR04_CD
              , 'Y'
              , 'SYSTEM'
              , GETDATE()
--                     ITEM_ATTR01_CD
                    --,ITEM_ATTR22_CD AS ITEM_ATTR02_NM
              --       ,ITEM_ATTR03_CD
             --        ,ITEM_ATTR23_CD AS ITEM_ATTR03_NM
--                     ,ITEM_ATTR04_CD
--                     ,ITEM_ATTR24_CD AS ITEM_ATTR04_NM
         from M4S_I002040_IF_DATA IF_DATA
            JOIN M4S_I002011_BAK COMM
              ON IF_DATA.ITEM_ATTR03_CD = COMM.ATTR02_VAL
            AND COMM.COMM_CD = 'ITEM_GUBUN03'
        WHERE ITEM_ATTR01_CD IS NOT NULL
         GROUP BY ITEM_ATTR04_CD
                 , ITEM_ATTR24_CD
                 , COMM_DTL_CD
--                     ,ITEM_ATTR01_CD
                   -- ,ITEM_ATTR22_CD
         --            ,ITEM_ATTR03_CD
                  --  ,ITEM_ATTR23_CD
--                      ,ITEM_ATTR04_CD
--                     ,ITEM_ATTR24_CD
--      ) T1
-- ON COMM_DTL_CD = T1.NM
--        WHERE 1=1
-- -- WHERE COMM_DTL_CD = T1.NM
--   AND COMM_CD = 'ITEM_GUBUN04'
-- -- AND T2.COMM_DTL_CD_NM IS NULL
--  AND COMM_DTL_CD IN ('P30402001','P10500101','P20900109','P10500101')
--   AND COMM_DTL_CD_NM != T1.ITEM_ATTR04_NM


11111011012    11111011005

SELECT * FROM M4S_I204030 WHERE SALES_MGMT_VRSN_ID = '202111_V0' AND LINK_SALES_MGMT_CD LIKE '%1005'

SELECT DISTINCT SP1.PLAN_PART_WEEK--SP1.PROJECT_CD
--     , SP1.DP_VRSN_ID
--     , SP1.SALES_MGMT_CD
--     , SP1.SALES_MGMT_NM
--     , SP1.ITEM_ATTR01_CD
--     , SP1.ITEM_ATTR01_NM
--     , SP1.ITEM_ATTR02_CD
--     , SP1.ITEM_ATTR02_NM
--     , SP1.ITEM_ATTR03_CD
--     , SP1.ITEM_ATTR03_NM
--     , SP1.ITEM_ATTR04_CD
--     , SP1.ITEM_ATTR04_NM
--     , SP1.ITEM_CD
--     , SP1.USER_CD
--     , SP1.PLAN_YY
--     , SP1.PLAN_YYMM
--     , SP1.PLAN_PART_WEEK
--     , SP1.PLAN_WEEK
     , SP2.YYMMDD
--     , SP1.SP1_QTY
--     , SP2.SP2_QTY
FROM M4S_O201001_NEW SP1-- 임시테이블
 JOIN M4S_O201002_NEW SP2
   ON SP1.PROJECT_CD = SP2.PROJECT_CD
  AND SP1.DP_VRSN_ID = SP2.DP_VRSN_ID
  AND SP1.SALES_MGMT_CD = SP2.SALES_MGMT_CD
  AND SP1.ITEM_CD = SP2.ITEM_CD
  AND SP1.USER_CD = SP2.USER_CD
  AND SP1.PLAN_YYMMDD = SP2.PLAN_YYMMDD
WHERE 1=1
  AND SP1.PROJECT_CD = :VS_PROJECT_CD
  AND SP1.DP_VRSN_ID = :VS_CB_DP_VRSN_ID
  AND SP1.ATTR08 = 'SP1'
  AND SP1.YYMMDD >= (SELECT PLAN_FROM_YYMMDD FROM M4S_O201010 WHERE DP_VRSN_ID = :VS_CB_DP_VRSN_ID)

ORDER BY SP1.PROJECT_CD
  ,SP1.DP_VRSN_ID
  ,SP1.SALES_MGMT_CD
  ,SP1.ITEM_CD
  ,SP1.USER_CD
  ,SP1.PLAN_YYMMDD

  AND SUBSTRING(SP1.SALES_MGMT_CD,1,2) = :VS_CB_SP2_C
  AND SUBSTRING(SP1.SALES_MGMT_CD,3,2) IN (:VS_MCB_SP2)
  AND SUBSTRING(SP1.SALES_MGMT_CD,5,3) IN (:VS_MCB_SP1_C)
  AND SUBSTRING(SP1.SALES_MGMT_CD,8,4) IN (:VS_MCB_SP1)


SELECT SP2.PROJECT_CD
     , SP2.DP_VRSN_ID
     , SP2.SALES_MGMT_CD
     , SHC.SALES_MGMT_NM
     , ITEM.ITEM_ATTR01_CD
     , ITEM.ITEM_ATTR01_NM
     , ITEM.ITEM_ATTR02_CD
     , ITEM.ITEM_ATTR02_NM
     , ITEM.ITEM_ATTR03_CD
     , ITEM.ITEM_ATTR03_NM
     , ITEM.ITEM_ATTR04_CD
     , ITEM.ITEM_ATTR04_NM
     , SP2.ITEM_CD
     , ITEM.ITEM_NM
     , SP2.PLAN_YYMMDD
     , SP2.USER_CD
     , SP2.SALES_MGMT_TYPE_CD
     , SP2.PLAN_WEEK
     , SP2.PLAN_PART_WEEK
     , SP2.PLAN_YYMM
     , SP2.PLAN_YY
     , ISNULL(SP1.SP1_QTY,0) SP1_QTY
     , SP2.SP2_QTY
FROM (
        SELECT PROJECT_CD
             , DP_VRSN_ID
             , SALES_MGMT_CD
             , ITEM_CD
             , PLAN_YYMMDD
             , USER_CD
             , SALES_MGMT_TYPE_CD
             , PLAN_WEEK
             , PLAN_PART_WEEK
             , PLAN_YYMM
             , PLAN_YY
             , SUM(DP_QTY) SP2_QTY
        FROM M4S_O201012
        WHERE 1=1
          AND PROJECT_CD = :VS_PROJECT_CD
          AND DP_VRSN_ID = :VS_CB_DP_VRSN_ID
--            AND SUBSTRING(SALES_MGMT_CD,1,2) = :VS_CB_SP2_C
--            AND SUBSTRING(SALES_MGMT_CD,3,2) IN (:VS_MCB_SP2)
--            AND SUBSTRING(SALES_MGMT_CD,5,3) IN (:VS_MCB_SP1_C)
--            AND SUBSTRING(SALES_MGMT_CD,8,4) IN (:VS_MCB_SP1)
        GROUP BY PROJECT_CD
             , DP_VRSN_ID
             , SALES_MGMT_CD
             , ITEM_CD
             , PLAN_YYMMDD
             , USER_CD
             , SALES_MGMT_TYPE_CD
             , PLAN_WEEK
             , PLAN_PART_WEEK
             , PLAN_YYMM
             , PLAN_YY
    ) SP2
  LEFT JOIN M4S_O201001_NEW SP1
    ON SP2.PROJECT_CD = SP1.PROJECT_CD
   AND SP2.DP_VRSN_ID = SP1.DP_VRSN_ID
   AND SP2.SALES_MGMT_CD = SP1.SALES_MGMT_CD
   AND SP2.PLAN_YYMMDD = SP1.PLAN_YYMMDD
   AND SP2.ITEM_CD = SP1.ITEM_CD
   AND SP2.USER_CD = SP1.USER_CD
   AND SP1.ATTR08 = 'SP1'
   AND SP1.YYMMDD >= (SELECT PLAN_FROM_YYMMDD FROM M4S_O201010 WHERE DP_VRSN_ID = :VS_CB_DP_VRSN_ID)
  JOIN VIEW_I002040 ITEM
    ON SP2.ITEM_CD = ITEM.ITEM_CD
--    AND ITEM.ITEM_ATTR01_CD = :VS_CB_ATTR1
--    AND ITEM.ITEM_ATTR02_CD IN (:VS_MCB_ATTR2)
--    AND ITEM.ITEM_ATTR03_CD IN (:VS_MCB_ATTR3)
--    AND ITEM.ITEM_ATTR04_CD IN (:VS_MCB_ATTR4)
--    AND ITEM.ITEM_CD IN (:VS_MCB_SKU)
  JOIN M4S_I204030 SHC
    ON SP2.PROJECT_CD = SHC.PROJECT_CD
   AND SP2.SALES_MGMT_CD = SHC.SALES_MGMT_CD
   AND SHC.SALES_MGMT_VRSN_ID = (SELECT SALES_MGMT_VRSN_ID FROM M4S_O201010 WHERE DP_VRSN_ID = :VS_CB_DP_VRSN_ID)
   AND SHC.SALES_MGMT_TYPE_CD = 'SP1'
select * from m4s_i002020

select * from m4s_i204050 where SALES_MGMT_VRSN_ID = '202111_V0'

SELECT * FROM M4S_i204040 where  SALES_MGMT_TYPE_CD = 'SP2' AND SALES_MGMT_VRSN_ID = '202111_V0' AND LINK_SALES_MGMT_CD = '1114'



SELECT * FROM M4S_O201001_NEW WHERE SALES_MGMT_CD = '11111021069' and dp_Vrsn_id = 'SP_2021W52.03' AND ATTR08 = 'SP1'

SELECT * FROM M4S_O201001_NEW WHERE 1=1
  AND PROJECT_CD = :VS_PROJECT_CD
  AND DP_VRSN_ID = :VS_CB_DP_VRSN_ID
  AND ATTR08 = 'SP2'